---

- name: Update webservers
  hosts: all
  remote_user: root
  become: yes

  vars:
    dir: /opt/python
    dir_python: /opt/python/Python-3.11.3
  tasks:
    # - name: upgrade all packages
    #   yum: name=* state=latest
    # - name: Install git, vim
    #   yum:
    #     name: "{{ item }}"
    #     state: latest
    #   loop:
    #     - git
    #     - vim
    #     - htop 
    #     - openssl-devel 
    #     - libffi-devel 
    #     - bzip2-devel 
    #     - wget
    #     - gcc
    #     - yum-utils
    #     - zlib-devel
    #     - cmake
    #     - pkgconfig
    # - name: install Development Tools
    #   yum: name="@Development Tools" state=latest update_cache=yes
    # - name: download some_service_def init.d script
    #   get_url:
    #     url:  https://www.python.org/ftp/python/3.11.3/Python-3.11.3.tgz
    #     dest: "{{ dir }}"
    # - name: untar
    #   ansible.builtin.unarchive:
    #     src: "{{ dir }}/Python-3.11.3.tgz"
    #     dest: "{{ dir }}"
    #   become: yes
    #   become_user: root
    # - name: conf
    #   shell: ./configure && make && make install
    #   args:
    #     chdir: "{{ dir_python}}"
    - name: Manually create the initial virtualenv
      command:
        cmd: "virtualenv {{ dir }}/venv -p python3.11"
        creates: "{{ dir }}/venv"

    # - name: Install requirements
    #   pip: 
    #     - "requirements=./requirements.txt"
    #     - "virtualenv={{ dir }}/venv"
    # - name: Remove
    #   yum:
    #     name: "{{ item }}"
    #     state: absent
    #   loop:
    #       - httpd
    #       - nginx
    #       - mysql 
    #   become: true
    # - name: Register Contents of PGDATA Folder
    #   shell: ls -la /var/
    #   register: pg_contents
    # - name: Register File Stat
    #   stat:
    #     path: /etc/nginx/nginx.conf
    #   register: stat_result
    # - debug: msg="{{ pg_contents.stdout }}"  
    # - name: download sources
    #   shell:
    #     - echo "asd"
    #     - hostname
    # - name: download sources
    #   get_url: url="https://www.python.org/ftp/python/3.9.5/Python-3.9.5.tgz"
    # - name: make
      # shell: groupinstall "Development Tools" -y
    # - name: Install git, vim
    #   yum:
    #     name:
    #       - openssl-devel
    #       - libffi-devel
    #       - bzip2-devel
    #     state: latest
    # - name: PIP install
    #   pip:
    #     name:
    #       - pyTelegramBotAPI
    #       - six
    #     executable: pip3
    #     state: present